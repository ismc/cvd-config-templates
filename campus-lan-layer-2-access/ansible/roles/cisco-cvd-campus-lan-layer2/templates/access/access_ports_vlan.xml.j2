{% set interfaces = [] %}
{% for item in cvd_access_ports %}
  {% set _ = interfaces.extend(item | interface_range) %}
{% endfor %}

<config>
  <native xmlns="http://cisco.com/ns/yang/Cisco-IOS-XE-native">
    <interface>

      {% for item in interfaces %}
      <{{ item | interface_split('name') }}>
        <name>{{ item | interface_split('index') }}</name>

        <switchport>
          <access xmlns="http://cisco.com/ns/yang/Cisco-IOS-XE-switch">
            <vlan>
              <vlan>{{ cvd_data_vlan_id }}</vlan>
            </vlan>
          </access>

          <voice xmlns="http://cisco.com/ns/yang/Cisco-IOS-XE-switch">
            <vlan>
              <vlan>{{ cvd_voice_vlan_id }}</vlan>
            </vlan>
          </voice>

          {# This should be done under the access_ports_host role, but it's here due to a rpc bug! #}
          <mode xmlns="http://cisco.com/ns/yang/Cisco-IOS-XE-switch">
            <access/>
          </mode>

        </switchport>
      </{{ item | interface_split('name') }}>
      {% endfor %}

    </interface>
  </native>
</config>
